<%
function updated(element)
{
  return $(element).attr('updated');
}

function before(what, where)
{
  var task = phoxy.DeferRender("inbox/itemize.entry", what);
  $(where).before(task);
}

__this.Defer(function()
{
  debugger;


  var container = __this.first().parents('table');
  var inbox = container.find('tr');
  __this.first().remove();

  var i = 0, n = 0;
  var i_max = inbox.length, n_max = __this.inbox.length;

  // This loop causing compare each element each time
  while (i < i_max && n < n_max)
  {
    if (__this.inbox[n].updated > updated(inbox[i]))
    {
      before(__this.inbox[n], inbox[i]);
      n++;
      continue;
    }

    i++;
  }

  if (i == i_max && n != n_max)
  {
    var tail_update
      = phoxy.DeferRender('inbox/itemize', {inbox: __this.inbox.slice(n)});
    container.append(tail_update);
  }
});

%>
<ancor></ancor>
